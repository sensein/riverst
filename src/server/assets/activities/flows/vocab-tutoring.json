{
  "name": "vocab-tutoring",
  "description": "A flow for an AI to help children learn vocabulary words from a book they are reading.",
  "state_config": {
    "stages": {
      "warm_up": {
        "checklist": {
          "friendly_greeting_done": false,
          "asked_about_audiobook": false,
          "followed_up_appropriately": false
        },
        "checklist_incomplete_message": "Please complete the following warm-up items: {}.",
        "checklist_complete_message": "Great job completing the warm-up stage. Now let's move on to the first vocabulary word.",
        "transition_logic" : {
          "conditions": [],
          "default_target_node": "vocab"

        }
      },
      "vocab": {
        "checklist": {
          "selected_unknown_word": false,
          "defined_simply": false,
          "asked_book_context_understanding": false,
          "asked_broader_context_understanding": false,
          "asked_for_new_sentence": false
        },
        "checklist_incomplete_message": "You made an error with and did not accomplish the following things, please read the task instructions thoroughly and the conversation thus far, and naturally fix this: {}.",
        "checklist_complete_message": "Great job teaching the vocab, now let's move on to a review phase to check mastery.",
        "transition_logic": {
          "conditions": [],
          "default_target_node": "review"
        }
      },
      "review": {
        "checklist": {
          "asked_for_definition": false,
          "asked_for_sentence": false,
          "provided_formal_definition": false
        },
        "checklist_incomplete_message": "Please complete the following review items: {}.",
        "checklist_complete_message": "Great job reviewing the vocab words. Now let's start to wrap up",
        "transition_logic": {
          "conditions": [],
          "default_target_node": "closing"
        }
      },
      "closing": {
        "checklist": {
          "praised_child": false,
          "encouraged_continued_reading": false,
          "suggested_word_usage": false,
          "summarized_learning": false
        },
        "checklist_incomplete_message": "Please complete the following closing items: {}.",
        "checklist_complete_message": "Great job wrapping up the session. You're all set for the next reading!",
        "transition_logic": {
          "conditions": [],
          "default_target_node": "end"
        }
      }
    },
    "user": {
      "index": null,
      "has_listened_to_book": false,
      "vocab_words_known": [],
      "vocab_words_taught+mastered": [],
      "vocab_words_taught+not_mastered": []
    },
    "activity": {
      "reading_context": {
        "indexable_by": "chapters",
        "book_title": "",
        "book_author": "",
        "pages": [
          {
            "text": "",
            "image": "",
            "vocab_words": [
              ""
            ]
          }
        ]
      }
    }
  },
  "flow_config": {
    "initial_node": "warm_up",
    "nodes": {
      "warm_up": {
        "name": "warm_up",
        "task_messages": [
          {
            "role": "system",
"content": "TOOLS:\nReading context with book content is automatically provided, but if they have to tell you what chapter they are on then you must use get_reading_context() to get the actual chapter details.\nSilently call check_warm_up_progress() after completing ALL warm-up steps (don't mention this to the child).\n\nCRITICAL RULE:\nDO NOT teach vocabulary during warm-up. You MUST call check_warm_up_progress() before beginning any vocabulary instruction.\n\nWARM-UP PROCEDURE:\n\nStep 1 - Friendly Greeting:\nWave (no need to say hi explicitly) AND ask about their week and wait for their response. \n\nStep 2 - Check Audiobook Progress:\nAsk if they listened to their audiobook this week.\n\nCheck chapter information - MANDATORY VERIFICATION:\nFIRST: Look at the Key Information section for \"Chapter Number:\"\n- If you see \"Chapter Number: 4\" → Say \"I see you're on Chapter 4\" and give brief summary\n- If you see \"Chapter Number: [any number]\" → Reference that chapter directly\n- If you see NO \"Chapter Number:\" listed → Then ask \"What chapter are you on?\"\nNEVER ask about the chapter if a chapter number is already provided in Key Information.\nIf chapter number IS present in Key Information: Reference that specific chapter number directly and give a very brief summary.\nIf chapter number is NOT present in Key Information: Ask \"What chapter are you on?\" then call get_reading_context() using the child's response.\n\nIf they have listened:\nAsk one thoughtful, age-appropriate follow-up question about the story or literary theme. Wait for replies and follow up appropriately, but keep exchanges very brief. Always prioritize moving the conversation forward rather than dwelling on book details.\n\nIf they have not listened:\nGently encourage them to start soon. Ask what time of day might work best for listening.\n\nStep 3: Do not say or do ANYTHING apart from calling the check_warm_up_progress function. This is an essential responsibility and if you neglect this you will be fired."
          }
        ],
        "functions": [
          {
            "type": "function",
            "function": {
              "name": "check_warm_up_progress",
              "description": "Based on non-summary parts of the conversation, check if all required warm-up elements have been covered in the preceding conversation. Return true or false for each item.",
              "parameters": {
                "type": "object",
                "properties": {
                  "friendly_greeting_done": {
                    "type": "boolean",
                    "description": "Did the model engage in friendly conversation to start?"
                  },
                  "asked_about_audiobook": {
                    "type": "boolean",
                    "description": "Did the model ask the child about the audiobook?"
                  },
                  "followed_up_appropriately": {
                    "type": "boolean",
                    "description": "Did the model asked appropriate follow-up questions based on child's response?"
                  },
                  "has_listened_to_book": {
                    "type": "boolean",
                    "description": "Whether the child has listened to their audiobook (for state checking)"
                  }
                },
                "required": [
                  "friendly_greeting_done",
                  "asked_about_audiobook",
                  "followed_up_appropriately",
                  "has_listened_to_book"
                ]
              },
              "handler": "general_handler"
            }
          },
          {
            "type": "function",
            "function": {
              "name": "get_reading_context",
              "description": "Get the current reading context, particularly when you previously had to ask what chapter we are on",
              "parameters": {
                "type": "object",
                "properties": {
                  "variable_name": {
                    "type": "string",
                    "description": "The name of the variable to retrieve",
                    "default": "reading_context"
                  },
                  "current_index": {
                    "type": "integer",
                    "description": "The current index of the reading context, supplied by the student after you ask"
                  }
                },
                "required": [
                  "variable_name",
                  "current_index"
                ]
              },
              "handler": "get_activity_handler"
            }
          }
        ],
        "pre_actions": [
          {
            "type": "tts_say",
            "text": "Hi there! It's so great to see you, I am your vocab tutor!"
          }
        ],
        "post_actions": [
          {
            "type": "get_variable",
            "variable_name": "reading_context",
            "handler": "get_variable_action_handler"
          }
        ],
        "role_messages": [
          {
            "role": "system",
            "content": "You are a warm, engaging tutor teaching vocabulary to a child as part of a reading program. Your tone should feel natural, conversational, and child-appropriate — avoid robotic or overly formal language. \n- Keep your responses brief. \n- Do not use emojis or special characters in your responses. \n Instead of Mr. or Mrs., use Mr or Mrs\n- Allow the child to respond, keep the things you say short and simple. \n- Confidently steer the conversation, covering all required elements. Getting sidetracked is fine but every statement should work to progress the conversation.\n- You are talking with a child, not at them."
          }
        ]
      },
      "vocab": {
        "name": "vocab",
        "task_messages": [
          {
            "role": "system",
            "content": "TOOLS:\nThe reading context with the text and associated vocabulary words has been automatically provided to you. Use details from the reading only as they naturally fit into the conversation.\nYou may silently call the check_vocabulary_progress() function only after completing all teaching steps for the current word. Do not mention that you are doing this.\nCRITICAL INSTRUCTION:\nDO NOT teach words the child already knows. If a child demonstrates they know a word, immediately move to the next word. This is essential for efficient learning.\nPROCEDURE:\nUsing the reading context that has been provided, you have access to the current vocabulary list and text.\nStart with the first vocabulary word. Ask the child:\n\"Do you know what [word] means?\"\nBased on their response:\nIf they say yes but don't explain, ask:\n\"Can you tell me what it means?\"\nIf they give a correct explanation implying that they do know it, MOVE ON TO ANOTHER WORD. This is very important! You do not need to teach words they already know.\nIf they don't know the word or explain it incorrectly, then and only then, continue teaching the word through natural conversation.\nTEACHING STEPS (only if the child does not know the word):\nIn a warm and conversational way (without listing steps), guide the child through the following:\nDefine the word using simple, child-friendly language.\nConnect it to the story:\nFind in the story where the word is used, and provide the child the sentence, ask them what they think the word means in this context. The word MUST be in the sentence you provide.\nProvide feedback to their response as needed.\nConnect it to their life:\nAsk the child to relate the word to their own experience (e.g.,\n\"What's something [word] in your own life?\")\nGive clear feedback.\nPractice using the word:\nAsk the child to make up a new sentence using the word.\nOffer support and correction as needed.\nOnce you have taught a vocab word that the student didn't already know, silently call check_vocabulary_progress() to move on. Do not keep going with words, and do not mention you are calling or checking anything at all!"
          }
        ],
        "functions": [
          {
            "type": "function",
            "function": {
              "name": "check_vocab_progress",
              "description": "Based on non-summary parts of the conversation, check progress through vocabulary instruction for both words",
              "parameters": {
                "type": "object",
                "properties": {
                  "selected_unknown_word": {
                    "type": "boolean",
                    "description": "Whether the model successfully selected a vocabulary word the child does not know, as verifed by the child."
                  },
                  "defined_simply": {
                    "type": "boolean",
                    "description": "Whether the model defined the word in simple terms."
                  },
                  "asked_book_context_understanding": {
                    "type": "boolean",
                    "description": "Whether the model asked for understanding within the context of the book"
                  },
                  "asked_broader_context_understanding": {
                    "type": "boolean",
                    "description": "Whether the model asked for understanding in broader context or general usage"
                  },
                  "asked_for_new_sentence": {
                    "type": "boolean",
                    "description": "Whether the model asked the child to use the word in a totally new sentence"
                  },
                  "vocab_words_known": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "List of vocab words the model asked about and child already knew and could provide accurate descriptions of."
                  }
                },
                "required": [
                  "selected_unknown_word",
                  "defined_simply",
                  "asked_book_context_understanding",
                  "asked_broader_context_understanding",
                  "asked_for_new_sentence",
                  "vocab_words_known"
                ]
              },
              "handler": "general_handler"
            }
          },
          {
            "type": "function",
            "function": {
              "name": "get_reading_context",
              "description": "Get the current reading context, particularly when you previously had to ask what chapter we are on",
              "parameters": {
                "type": "object",
                "properties": {
                  "variable_name": {
                    "type": "string",
                    "description": "The name of the variable to retrieve",
                    "default": "reading_context"
                  },
                  "current_index": {
                    "type": "integer",
                    "description": "The current index of the reading context, supplied by the student after you ask"
                  }
                },
                "required": [
                  "variable_name",
                  "current_index"
                ]
              },
              "handler": "get_activity_handler"
            }
          }
        ],
        "pre_actions": [
          {
            "type": "tts_say",
            "text": "Okay, now let's move on to some vocabulary work."
          },
          {
            "type": "get_variable",
            "variable_name": "vocab",
            "handler": "get_variable_action_handler"
          }
        ]
      },
      "review": {
        "name": "review",
        "task_messages": [
          {
            "role": "system",
            "content": "Now conduct a SECOND ROUND of assessment for the vocabulary words we taught today.\n\nFor each word that required teaching (skip words they already knew), repeat these same three steps you did during instruction:\n1. Ask the child to define the word again in their own words\n2. Ask them to use the word in a new sentence without any help  \n3. Provide the formal definition one more time\n\nThis is the second time doing these steps - the first was during teaching, now you're doing them again as final review. Make this feel natural while systematically covering all elements again. Give detailed feedback to determine true mastery.\n\nAfter completing this second assessment round for all taught words, silently call check_review_progress (do not mention this function, or that you are checking anything at all!)"
          }
        ],
        "functions": [
          {
            "type": "function",
            "function": {
              "name": "check_review_progress",
              "description": "Based on non-summary parts of the conversation, check progress through review and recap of both words",
              "parameters": {
                "type": "object",
                "properties": {
                  "asked_for_definition": {
                    "type": "boolean",
                    "description": "Whether the model asked the child to define the word again"
                  },
                  "asked_for_sentence": {
                    "type": "boolean",
                    "description": "Whether the model asked for a new sentence once again"
                  },
                  "provided_formal_definition": {
                    "type": "boolean",
                    "description": "Whether the model provided the formal definition again"
                  },
                  "vocab_words_taught+mastered": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Info field for vocab_words_taught+mastered"
                  },
                  "vocab_words_taught+not_mastered": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Info field for vocab_words_taught+not_mastered"
                  }
                },
                "required": [
                  "asked_for_definition",
                  "asked_for_sentence",
                  "provided_formal_definition",
                  "vocab_words_taught+mastered",
                  "vocab_words_taught+not_mastered"
                ]
              },
              "handler": "general_handler"
            }
          },
          {
            "type": "function",
            "function": {
              "name": "get_reading_context",
              "description": "Get the current reading context, particularly when you previously had to ask what chapter we are on",
              "parameters": {
                "type": "object",
                "properties": {
                  "variable_name": {
                    "type": "string",
                    "description": "The name of the variable to retrieve",
                    "default": "reading_context"
                  },
                  "current_index": {
                    "type": "integer",
                    "description": "The current index of the reading context, supplied by the student after you ask"
                  }
                },
                "required": [
                  "variable_name",
                  "current_index"
                ]
              },
              "handler": "get_activity_handler"
            }
          }
        ],
        "pre_actions": [
          {
            "type": "tts_say",
            "text": "Okay, now let's cover the words once more to ensure you have really got them down."
          }
        ]
      },
      "closing": {
        "name": "closing",
        "task_messages": [
          {
            "role": "system",
            "content": "Close the session by praising the child that they've done a great job today. VERY BRIEFLY encourage continued reading, suggested word usage, and summarize the learning. \n\nCRITICALLY IMPORTANT: After completing these steps silently call the check_closing_progress() function. Do not mention that you are doing this."
          }
        ],
        "functions": [
          {
            "type": "function",
            "function": {
              "name": "check_closing_progress",
              "description": "Based on non-summary parts of the conversation, check completion of closing elements. This must be based on actual conversation, not the reading context or summary. If there is no conversation, then these checks MUST fail.",
              "parameters": {
                "type": "object",
                "properties": {
                  "praised_child": {
                    "type": "boolean",
                    "description": "Whether the model praised the child for their work"
                  },
                  "encouraged_continued_reading": {
                    "type": "boolean",
                    "description": "Whether the model encouraged continued listening to the audiobook"
                  },
                  "suggested_word_usage": {
                    "type": "boolean",
                    "description": "Whether the model suggested noticing or using the words"
                  },
                  "summarized_learning": {
                    "type": "boolean",
                    "description": "Whether the model summarized what was learned"
                  }
                },
                "required": [
                  "praised_child",
                  "encouraged_continued_reading",
                  "suggested_word_usage",
                  "summarized_learning"
                ]
              },
              "handler": "general_handler"
            }
          }
        ],
        "post_actions": [
          {
            "type": "get_variable",
            "variable_name": "reading_context",
            "handler": "get_variable_action_handler"
          }
        ]
      },
      "end": {
        "task_messages": [
          {
            "role": "system",
            "content": "The session is now complete. Say goodbye in a friendly and encouraging way."
          }
        ],
        "functions": [],
        "post_actions": [
          {
            "type": "end_conversation",
            "text": "Thank you for learning with me today, have a wonderful day!"
          }
        ]
      }
    }
  }
}
